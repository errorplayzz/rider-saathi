â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ GROUP ADMIN & ADD MORE MEMBERS - SETUP INSTRUCTIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… CHANGES MADE:

1. âœ¨ "Add More Members" button now visible for ALL group chats
2. ğŸ‘‘ Admin badge shows next to group admin
3. ğŸ›¡ï¸ Moderator badge shows next to moderators  
4. ğŸ¯ Group creator automatically becomes admin

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ SQL MIGRATION REQUIRED:

Run this SQL in your Supabase Dashboard â†’ SQL Editor:

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

-- Function to create chat room with participants atomically
-- The creator is automatically added as admin

CREATE OR REPLACE FUNCTION create_chat_room_with_participants(
  room_name TEXT,
  room_type TEXT,
  participant_ids UUID[],
  creator_id UUID
)
RETURNS UUID
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  new_room_id UUID;
  participant_id UUID;
BEGIN
  -- Create the chat room
  INSERT INTO chat_rooms (name, room_type, created_by)
  VALUES (room_name, room_type, creator_id)
  RETURNING id INTO new_room_id;
  
  -- Add creator as admin
  INSERT INTO room_participants (room_id, user_id, role)
  VALUES (new_room_id, creator_id, 'admin');
  
  -- Add other participants as members
  FOREACH participant_id IN ARRAY participant_ids
  LOOP
    -- Skip if participant is the creator (already added as admin)
    IF participant_id != creator_id THEN
      INSERT INTO room_participants (room_id, user_id, role)
      VALUES (new_room_id, participant_id, 'member')
      ON CONFLICT (room_id, user_id) DO NOTHING;
    END IF;
  END LOOP;
  
  RETURN new_room_id;
END;
$$;

-- Grant execute permission
GRANT EXECUTE ON FUNCTION create_chat_room_with_participants TO authenticated;

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ¨ FEATURES NOW AVAILABLE:

1. Click 3-dot menu â†’ "Participants"
2. See "Add More Members" button (with + icon)
3. Admin users have yellow "Admin" badge
4. Moderators have blue "Moderator" badge
5. Group creator = automatic admin

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
